# 小欣餐饮数据库设计文档
| 版本 |   日期    | 描述 |  作者  |
| :--: | :-------: | :--: | :----: |
| V1.1 | 2018-5-31 | 初稿 | Nathan |

## ER图

[数据库ER图](07-02-02-ER模型)

## 数据库实体说明

* base数据表（所有数据表的父类）：
  状态（删除或未删除） 修改时间，创建时间
* user数据表：
  uid（主键） username phone number email gender avatar password（加密后的） confirm(是否验证邮箱)
* 管理员数据表（继承user，表示餐厅管理员）：
  rid（外键，与restaurant数据表连接）
* Address数据表：
  id（主键），uid（外键，表示user）, province_id,province_str,city_id,city_str,area_id,area_str,address(具体的街道)，is_default（是否为默认地址）
* cart数据表：
  id(主键)，uid（外键，表示user），did（外键，表示dish），quantity（表示数量）
* dish数据表：
  id（主键），rid（外键，表示restaurant）,name,price,summary.stock,tag,main_image
* order数据表（订单):
  id,order_sn（订单流水号）,uid（外键，用户）,cid（外键，优惠券）,total_price（菜单价格）,fair_price（运费价格）,pay_price（支付价格）,pay_sn（支付流水号）,prepay_id（预支付id）,note（备注）,express_status（送货状态）,comment_status（评价状态）,aid（外键，送货地址）,pay_time（支付时间）
* order_item数据表（购买订单中单个菜肴）：
  id（主键）,oid（外键，订单）,quantity（数量）,did（外键，菜肴）
* coupon数据表：
  id（主键），uid（外键，用户）,discount（优惠价格）,expiration_date（过期时间）
* Order_callback数据表（订单退款）：
  id（主键）,oid（外键，订单），refund_data（退款日期）
* comment数据表：
  id（主键），oid（外键，订单），score（评分），content（评价内容）
* restaurant数据表：
  id(主键)，aid（外键，表示address），name,summary,main_image,month_count,total_count,view_count,comment_count

## 数据库关系说明

* Own

  User : Cart = 1 : 1

* Obtain

  User : Coupon = 1 : N

* Is

  User : Administrator = 1 : N

* Make

  User : Order = 1 : N

* Live in

  User : Address = N : N

* Contain

  Cart : Dish = N : N

* Refer to

  Dish : Order_Item = 1 : N

* Locate

  Restaurant : Address = 1 : 1

* Manage

  Administrator : Restaurant = 1 : N

* Cook

  Restaurant : Dish = N : N

* Send to

  Address : Order = 1 : 1

* Include

  Order : Order_Item = 1 : N

* Use

  Order : Coupon = 1 : N

* Have

  Order : Comment = 1 : 1

* Cancel

  Order : Order_callback = 1 : 1